<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <?define ProductName = "Hive Agent" ?>
  <?define ProductManufacturer = "HiveIO Inc" ?>
  <?define ProductId = "3f8d4707-42e9-4c43-ba9d-4301d75340cc" ?>
  <?define ProductUpgradeId = "037749a8-68b8-4502-b0ec-fe0df974ade3" ?>
  <?define ProductVersion = "8.3.1.0" ?>
  <?define ServiceName = "HiveAgent" ?>
  <Product Id="*" Name="$(var.ProductName)" Language="1033" Version="$(var.ProductVersion)" Manufacturer="$(var.ProductManufacturer)" UpgradeCode="$(var.ProductUpgradeId)">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />
    <Feature Id="ProductFeature" Title="HarvestSetup" Level="1">
      <ComponentGroupRef Id="AutogeneratedComponents" />
    </Feature>
    <!--Add Icon and ARPPRODUCTICON (the installer icon). ref.: http://wixtoolset.org/documentation/manual/v3/howtos/ui_and_localization/configure_arp_appearance.html -->
    <Icon Id="icon.ico" SourceFile="..\Hive.WindowsAgent.UI\Resources\HiveIcon.ico" />
    <!--<Property Id="ARPPRODUCTICON" Value="icon.ico" />-->
    <UI />
  </Product>
  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFiles64Folder">
        <Directory Id="INSTALLFOLDER" Name="$(var.ProductManufacturer)" ComponentGuidGenerationSeed="4BDDE809-FF2B-4DF9-B1D6-2DBA45AB122F">
        </Directory>
      </Directory>
    </Directory>
  </Fragment>
  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="ProductServiceInstaller" Guid="31314670-CBA0-48EE-A1A4-47F1D1C28E91">
        <!-- Where to defined Product Path and where to point it? -->
        <File Id="$(var.ServiceName)" Source="$(var.ProductPath)" KeyPath="yes" />
        <ServiceInstall Id="ServiceInstaller"
                        Type="ownProcess"
                        Name="$(var.ServiceName)"
                        Start="auto"
                        ErrorControl="normal" />
        <ServiceControl Id="StartStopService"
                        Stop="both"
                        Remove="uninstall"
                        Name="$(var.ServiceName)"
                        Wait="yes" />
      </Component>
      <Component Id="InstallPath" Guid="4380A488-8B37-4866-9CC2-BC1E4124FF81">
        <RegistryValue Id="InstallPath"
                       Root="HKLM"
                       Key="SOFTWARE\$(var.ServiceName)"
                       Name="Install Path"
                       Value="[INSTALLFOLDER]"
                       Type="string"
                       KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>